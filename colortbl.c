#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include "inttypes.h"
#include "platform.h"

#include "colortbl.h"

const rgb_triple_t color_table_1_bit [2] = {
    { 0x00, 0x00, 0x00 }, { 0xFF, 0xFF, 0xFF }
};

const rgb_triple_t color_table_4_bit [16] = {
    { 0x00, 0x00, 0x00 }, { 0x00, 0x00, 0x80 },
    { 0x00, 0x80, 0x00 }, { 0x00, 0x80, 0x80 },
    { 0x80, 0x00, 0x00 }, { 0x80, 0x00, 0x80 },
    { 0x80, 0x80, 0x00 }, { 0x80, 0x80, 0x80 },
    { 0xC0, 0xC0, 0xC0 }, { 0x00, 0x00, 0xFF },
    { 0x00, 0xFF, 0x00 }, { 0x00, 0xFF, 0xFF },
    { 0xFF, 0x00, 0x00 }, { 0xFF, 0x00, 0xFF },
    { 0xFF, 0xFF, 0x00 }, { 0xFF, 0xFF, 0xFF }
};

const rgb_triple_t color_table_8_bit [256] = {
    { 0x00, 0x00, 0x00 }, { 0x00, 0x00, 0x80 }, // 0x00
    { 0x00, 0x80, 0x00 }, { 0x00, 0x80, 0x80 },
    { 0x80, 0x00, 0x00 }, { 0x80, 0x00, 0x80 },
    { 0x80, 0x80, 0x00 }, { 0xC0, 0xC0, 0xC0 },
    { 0xC0, 0xDC, 0xC0 }, { 0xF0, 0xCA, 0xA6 },
    { 0x00, 0x20, 0x40 }, { 0x00, 0x20, 0x60 },
    { 0x00, 0x20, 0x80 }, { 0x00, 0x20, 0xA0 },
    { 0x00, 0x20, 0xC0 }, { 0x00, 0x20, 0xE0 },
    { 0x00, 0x40, 0x00 }, { 0x00, 0x40, 0x20 }, // 0x10
    { 0x00, 0x40, 0x40 }, { 0x00, 0x40, 0x60 },
    { 0x00, 0x40, 0x80 }, { 0x00, 0x40, 0xA0 },
    { 0x00, 0x40, 0xC0 }, { 0x00, 0x40, 0xE0 },
    { 0x00, 0x60, 0x00 }, { 0x00, 0x60, 0x20 },
    { 0x00, 0x60, 0x40 }, { 0x00, 0x60, 0x60 },
    { 0x00, 0x60, 0x80 }, { 0x00, 0x60, 0xA0 },
    { 0x00, 0x60, 0xC0 }, { 0x00, 0x60, 0xE0 },
    { 0x00, 0x80, 0x00 }, { 0x00, 0x80, 0x20 }, // 0x20
    { 0x00, 0x80, 0x40 }, { 0x00, 0x80, 0x60 },
    { 0x00, 0x80, 0x80 }, { 0x00, 0x80, 0xA0 },
    { 0x00, 0x80, 0xC0 }, { 0x00, 0x80, 0xE0 },
    { 0x00, 0xA0, 0x00 }, { 0x00, 0xA0, 0x20 },
    { 0x00, 0xA0, 0x40 }, { 0x00, 0xA0, 0x60 },
    { 0x00, 0xA0, 0x80 }, { 0x00, 0xA0, 0xA0 },
    { 0x00, 0xA0, 0xC0 }, { 0x00, 0xA0, 0xE0 },
    { 0x00, 0xC0, 0x00 }, { 0x00, 0xC0, 0x20 }, // 0x30
    { 0x00, 0xC0, 0x40 }, { 0x00, 0xC0, 0x60 },
    { 0x00, 0xC0, 0x80 }, { 0x00, 0xC0, 0xA0 },
    { 0x00, 0xC0, 0xC0 }, { 0x00, 0xC0, 0xE0 },
    { 0x00, 0xE0, 0x00 }, { 0x00, 0xE0, 0x20 },
    { 0x00, 0xE0, 0x40 }, { 0x00, 0xE0, 0x60 },
    { 0x00, 0xE0, 0x80 }, { 0x00, 0xE0, 0xA0 },
    { 0x00, 0xE0, 0xC0 }, { 0x00, 0xE0, 0xE0 },
    { 0x40, 0x00, 0x00 }, { 0x40, 0x00, 0x20 }, // 0x40
    { 0x40, 0x00, 0x40 }, { 0x40, 0x00, 0x60 },
    { 0x40, 0x00, 0x80 }, { 0x40, 0x00, 0xA0 },
    { 0x40, 0x00, 0xC0 }, { 0x40, 0x00, 0xE0 },
    { 0x40, 0x20, 0x00 }, { 0x40, 0x20, 0x20 },
    { 0x40, 0x20, 0x40 }, { 0x40, 0x20, 0x60 },
    { 0x40, 0x20, 0x80 }, { 0x40, 0x20, 0xA0 },
    { 0x40, 0x20, 0xC0 }, { 0x40, 0x20, 0xE0 },
    { 0x40, 0x40, 0x00 }, { 0x40, 0x40, 0x20 }, // 0x50
    { 0x40, 0x40, 0x40 }, { 0x40, 0x40, 0x60 },
    { 0x40, 0x40, 0x80 }, { 0x40, 0x40, 0xA0 },
    { 0x40, 0x40, 0xC0 }, { 0x40, 0x40, 0xE0 },
    { 0x40, 0x60, 0x00 }, { 0x40, 0x60, 0x20 },
    { 0x40, 0x60, 0x40 }, { 0x40, 0x60, 0x60 },
    { 0x40, 0x60, 0x80 }, { 0x40, 0x60, 0xA0 },
    { 0x40, 0x60, 0xC0 }, { 0x40, 0x60, 0xE0 },
    { 0x40, 0x80, 0x00 }, { 0x40, 0x80, 0x20 }, // 0x60
    { 0x40, 0x80, 0x40 }, { 0x40, 0x80, 0x60 },
    { 0x40, 0x80, 0x80 }, { 0x40, 0x80, 0xA0 },
    { 0x40, 0x80, 0xC0 }, { 0x40, 0x80, 0xE0 },
    { 0x40, 0xA0, 0x00 }, { 0x40, 0xA0, 0x20 },
    { 0x40, 0xA0, 0x40 }, { 0x40, 0xA0, 0x60 },
    { 0x40, 0xA0, 0x80 }, { 0x40, 0xA0, 0xA0 },
    { 0x40, 0xA0, 0xC0 }, { 0x40, 0xA0, 0xE0 },
    { 0x40, 0xC0, 0x00 }, { 0x40, 0xC0, 0x20 }, // 0x70
    { 0x40, 0xC0, 0x40 }, { 0x40, 0xC0, 0x60 },
    { 0x40, 0xC0, 0x80 }, { 0x40, 0xC0, 0xA0 },
    { 0x40, 0xC0, 0xC0 }, { 0x40, 0xC0, 0xE0 },
    { 0x40, 0xE0, 0x00 }, { 0x40, 0xE0, 0x20 },
    { 0x40, 0xE0, 0x40 }, { 0x40, 0xE0, 0x60 },
    { 0x40, 0xE0, 0x80 }, { 0x40, 0xE0, 0xA0 },
    { 0x40, 0xE0, 0xC0 }, { 0x40, 0xE0, 0xE0 },
    { 0x80, 0x00, 0x00 }, { 0x80, 0x00, 0x20 }, // 0x80
    { 0x80, 0x00, 0x40 }, { 0x80, 0x00, 0x60 },
    { 0x80, 0x00, 0x80 }, { 0x80, 0x00, 0xA0 },
    { 0x80, 0x00, 0xC0 }, { 0x80, 0x00, 0xE0 },
    { 0x80, 0x20, 0x00 }, { 0x80, 0x20, 0x20 },
    { 0x80, 0x20, 0x40 }, { 0x80, 0x20, 0x60 },
    { 0x80, 0x20, 0x80 }, { 0x80, 0x20, 0xA0 },
    { 0x80, 0x20, 0xC0 }, { 0x80, 0x20, 0xE0 },
    { 0x80, 0x40, 0x00 }, { 0x80, 0x40, 0x20 }, // 0x90
    { 0x80, 0x40, 0x40 }, { 0x80, 0x40, 0x60 },
    { 0x80, 0x40, 0x80 }, { 0x80, 0x40, 0xA0 },
    { 0x80, 0x40, 0xC0 }, { 0x80, 0x40, 0xE0 },
    { 0x80, 0x60, 0x00 }, { 0x80, 0x60, 0x20 },
    { 0x80, 0x60, 0x40 }, { 0x80, 0x60, 0x60 },
    { 0x80, 0x60, 0x80 }, { 0x80, 0x60, 0xA0 },
    { 0x80, 0x60, 0xC0 }, { 0x80, 0x60, 0xE0 },
    { 0x80, 0x80, 0x00 }, { 0x80, 0x80, 0x20 }, // 0xA0
    { 0x80, 0x80, 0x40 }, { 0x80, 0x80, 0x60 },
    { 0x80, 0x80, 0x80 }, { 0x80, 0x80, 0xA0 },
    { 0x80, 0x80, 0xC0 }, { 0x80, 0x80, 0xE0 },
    { 0x80, 0xA0, 0x00 }, { 0x80, 0xA0, 0x20 },
    { 0x80, 0xA0, 0x40 }, { 0x80, 0xA0, 0x60 },
    { 0x80, 0xA0, 0x80 }, { 0x80, 0xA0, 0xA0 },
    { 0x80, 0xA0, 0xC0 }, { 0x80, 0xA0, 0xE0 },
    { 0x80, 0xC0, 0x00 }, { 0x80, 0xC0, 0x20 }, // 0xB0
    { 0x80, 0xC0, 0x40 }, { 0x80, 0xC0, 0x60 },
    { 0x80, 0xC0, 0x80 }, { 0x80, 0xC0, 0xA0 },
    { 0x80, 0xC0, 0xC0 }, { 0x80, 0xC0, 0xE0 },
    { 0x80, 0xE0, 0x00 }, { 0x80, 0xE0, 0x20 },
    { 0x80, 0xE0, 0x40 }, { 0x80, 0xE0, 0x60 },
    { 0x80, 0xE0, 0x80 }, { 0x80, 0xE0, 0xA0 },
    { 0x80, 0xE0, 0xC0 }, { 0x80, 0xE0, 0xE0 },
    { 0xC0, 0x00, 0x00 }, { 0xC0, 0x00, 0x20 }, // 0xC0
    { 0xC0, 0x00, 0x40 }, { 0xC0, 0x00, 0x60 },
    { 0xC0, 0x00, 0x80 }, { 0xC0, 0x00, 0xA0 },
    { 0xC0, 0x00, 0xC0 }, { 0xC0, 0x00, 0xE0 },
    { 0xC0, 0x20, 0x00 }, { 0xC0, 0x20, 0x20 },
    { 0xC0, 0x20, 0x40 }, { 0xC0, 0x20, 0x60 },
    { 0xC0, 0x20, 0x80 }, { 0xC0, 0x20, 0xA0 },
    { 0xC0, 0x20, 0xC0 }, { 0xC0, 0x20, 0xE0 },
    { 0xC0, 0x40, 0x00 }, { 0xC0, 0x40, 0x20 }, // 0xD0
    { 0xC0, 0x40, 0x40 }, { 0xC0, 0x40, 0x60 },
    { 0xC0, 0x40, 0x80 }, { 0xC0, 0x40, 0xA0 },
    { 0xC0, 0x40, 0xC0 }, { 0xC0, 0x40, 0xE0 },
    { 0xC0, 0x60, 0x00 }, { 0xC0, 0x60, 0x20 },
    { 0xC0, 0x60, 0x40 }, { 0xC0, 0x60, 0x60 },
    { 0xC0, 0x60, 0x80 }, { 0xC0, 0x60, 0xA0 },
    { 0xC0, 0x60, 0xC0 }, { 0xC0, 0x60, 0xE0 },
    { 0xC0, 0x80, 0x00 }, { 0xC0, 0x80, 0x20 }, // 0xE0
    { 0xC0, 0x80, 0x40 }, { 0xC0, 0x80, 0x60 },
    { 0xC0, 0x80, 0x80 }, { 0xC0, 0x80, 0xA0 },
    { 0xC0, 0x80, 0xC0 }, { 0xC0, 0x80, 0xE0 },
    { 0xC0, 0xA0, 0x00 }, { 0xC0, 0xA0, 0x20 },
    { 0xC0, 0xA0, 0x40 }, { 0xC0, 0xA0, 0x60 },
    { 0xC0, 0xA0, 0x80 }, { 0xC0, 0xA0, 0xA0 },
    { 0xC0, 0xA0, 0xC0 }, { 0xC0, 0xA0, 0xE0 },
    { 0xC0, 0xC0, 0x00 }, { 0xC0, 0xC0, 0x20 }, // 0xF0
    { 0xC0, 0xC0, 0x40 }, { 0xC0, 0xC0, 0x60 },
    { 0xC0, 0xC0, 0x80 }, { 0xC0, 0xC0, 0xA0 },
    { 0xF0, 0xFB, 0xFF }, { 0xA4, 0xA0, 0xA0 },
    { 0x80, 0x80, 0x80 }, { 0x00, 0x00, 0xFF },
    { 0x00, 0xFF, 0x00 }, { 0x00, 0xFF, 0xFF },
    { 0xFF, 0x00, 0x00 }, { 0xFF, 0x00, 0xFF },
    { 0xFF, 0xFF, 0x00 }, { 0xFF, 0xFF, 0xFF }
};

uint32_t get_colors_num(uint32_t bit_count)
{
    switch (bit_count)
    {
        case  1: return COLORS_IN_1_BIT_TABLE;
        case  4: return COLORS_IN_4_BIT_TABLE;
        case  8: return COLORS_IN_8_BIT_TABLE;
        default: break;
    }
    return 0;
}

rgb_triple_t* get_color_table_triple(uint32_t bit_count)
{
    uint32_t      colors_num  = get_colors_num(bit_count);
    rgb_triple_t* color_table = (rgb_triple_t*) malloc(sizeof(rgb_triple_t) * colors_num);

    if (! color_table)
        return NULL;

    switch (bit_count)
    {
        case  1: memcpy(color_table, color_table_1_bit, sizeof(color_table_1_bit)); break;
        case  4: memcpy(color_table, color_table_4_bit, sizeof(color_table_4_bit)); break;
        case  8: memcpy(color_table, color_table_8_bit, sizeof(color_table_8_bit)); break;
        default:
            free(color_table);
            return NULL;
    }

    return color_table;
}

rgb_quad_t* get_color_table_quad(uint32_t bit_count)
{
          uint32_t   i, colors_num  = get_colors_num(bit_count);
          rgb_quad_t*   color_table = (rgb_quad_t*) malloc(sizeof(rgb_quad_t) * colors_num);
    const rgb_triple_t* base_table  = NULL;

    if (! color_table)
        return NULL;

    switch (bit_count)
    {
        case  1: base_table = color_table_1_bit; break;
        case  4: base_table = color_table_4_bit; break;
        case  8: base_table = color_table_8_bit; break;
        default:
            free(color_table);
            return NULL;
    }

    for (i = 0; i < colors_num; i ++)
    {
        color_table[i].blue     = base_table[i].blue;
        color_table[i].green    = base_table[i].green;
        color_table[i].red      = base_table[i].red;
        color_table[i].reserved = 0;
    }

    return color_table;
}
